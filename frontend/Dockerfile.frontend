# ── Stage 1: Builder (依存関係のインストールとビルド) ──
FROM node:22-slim AS builder

# 作業ディレクトリを設定
WORKDIR /frontend

# 依存関係ファイルのみをコピーしてキャッシュを最大化
COPY package*.json ./

# 依存関係をインストール
RUN npm install

# アプリケーションソースをコピー
COPY . .


# ── Stage 2: Runtime (実行用イメージ) ──
FROM node:22-slim AS runner
 
WORKDIR /frontend

# builder ステージから必要なファイルをコピー
COPY --from=builder /frontend /frontend